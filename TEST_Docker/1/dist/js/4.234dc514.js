"use strict";(self["webpackChunkclaimApp_web"]=self["webpackChunkclaimApp_web"]||[]).push([[4],{2004:function(e,a,t){t.r(a),t.d(a,{default:function(){return le}});t(2490),t(4514);var l=t(6252),s=t(3577),o=t(2262),n=t(6402),i=t(8339),u=(t(7658),t(8862),t(9924),t(2402)),r=t(9963),d="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAFA0lEQVR4AeyaXWgUVxTHN18PaSmU0hZaqgG1BWkpbSMFhdqE1lCFJJNN96kvhdj2oW188Pspmyc16oMfCH5En3xJzGaTgEpUEhUUxFURRfALoqKgIoJoHvLl78iu3rmT7Mzsmsw4O+Ge3HvPnTnnf/733JmdO1McKfC/kIACT4BImAFhBhQ4A+ESKPAECC+CjpdAXV3dB4ZhVBmGsRKJeyBL6+vrZ73tjLUlgEB/aWhoOFNSUvKkqKhoANmCtHggh4uLi++A5way/W0RkZUAAm8m0OM4W4iUIp4X8MxD/gfbLTLip3wBTUkALA9hfBvi1zKHjDgFzng+ACclAHZPwvLsfAzP1LngbIGEubn6sxCAsRUYW4zo5SnOulBunpiYaPVA2vEpyxEI5kIm5HxNMBFQU1PzPkGuNJuPRNAlcV6dSCR+7+7uXpNMJuPJmZfl+FwCjtaI9oduGRPnaClop5p/B5SXl3/DAfqt5uzIyMgfOL/EmOcFHHEC/kcHwiR9r+uc9E0ZQCp9rZ+E4dV9fX0vdL2XfUjYg//7iFryJ4BgF6gW0+3b6dpXFVhTGqBZ0Wj0i4yOC/lvyAZkQJYHYw2ZMbU2ZQCpNV8dlDbr/oHUumA4hnRg+AAO/tbHp7s/Pj5+QfeBbl5lZWUZeDYxdgRZh1RBVguxJcArmYPqTTER8EadvWUYhlxwOjgqhuE/cbAb4zH6npeKiopB8KyZAshfYG9Sx1wTUFtb+zEOWlQj6XZHLBb7JN32pALXABOyKJtzrnM/quOuCeCZQO4Uqo3Xbe4Wlovo60GfNCDoKxWKawLGxsauqAbUdllZ2VW174P2QzsMrgnglvgYFtfqhkm/5s7Ozke63qs+eNqZrCV2/l0TIAa5D7dBwgKc/Eu/SdrcLXbQ9kORh7hG8Czv7e29bAcoJwLEKCSkcLKLn8b7pS06r4UJ2VlaWjofTAmnWHImwKmDmTyO3wFdLMNhNz4DRYCbwDPHhgRkmCjUOvAZYDexIQF2DAV9PMyAoM+wXXxhBtgx9C6N86zfyJ5EuRvMgcoAHsr+Gx0dvcbuVNQpCYEiIB10BXUXe5X7eKP9Le2sJYgEvAqYbGhi9+rYq06Wf4ElIB3zp+l6yiroBFgCZ8/guqoMFAGkfTUBnlED1NvsGZxTdYEiQAIbGhqqgog2aU8ie9m9alf1JgJg75o6KG2upp9J7Tfhnv+DjgndzVQqNUKQsmm7lPGNyCCEtBJblK0yyxssEwEceJ4T9DJHV/ihD9ZKDcdd9ijvZXQEexRZj1RDSJyx7syYWpsIYH1Y9vVxtJm3Qe+pJ3nd5vWWzOTnGo6L0ncrJgKGh4flpcddzchCXngcxOl3mt6TLjjipPNu3TkTlT8B/f39zzG0dRLjBk4HuB4c4mdmm4DwQPbh8xg4LO8l0R2WNNdxO+mbMkBOwJB8GXZK2pp8CDmN6Fbj0IvvBJvw+yv+LYWl22xROlRYCJDzuHD8TLB3pO13Aad8r3QrV5yTEiDGyAR5qJAvxqTrR7nNzC8Gp+WjKTdgpyRAjJAJ22FY0u4s/VHE8wKem8gOsM3t6ek5nS+grASIcRg+gbNFvGn9CMfVyCrEi+8ElzHjs8HzJZLzmpeYVLElIHMwb1qf4XgQ2YrIuptpOcKM67foDLyca8cE5OzB5yeGBPh8gqYdXpgB006xzx2EGeDzCZp2eO98BuTL0EsAAAD//9m8m6MAAAAGSURBVAMA5t52ropqPS8AAAAASUVORK5CYII=",c=t(381),v=t.n(c),g=(t(4246),t(1831));const p={class:"h5-call-dialog"},m={id:"h5-call-container",class:"call-container"},k={key:0,class:"system-status"},f={key:1,class:"system-status error"},y={key:2,class:"login-status"},w={key:3,id:"call-main",class:"call-main"},h={class:"phone-input-section"},b={key:1,class:"calling-status"},N={key:2,class:"calling-status"},C={class:"call-controls"},A={key:0,class:"button-group"},E={key:1,class:"button-group"},T={class:"dialog-actions"};var _={__name:"H5CallDialog",props:{show:{type:Boolean,default:!1},initialPhone:{type:String,default:""},sdkConfig:{type:Object,default:()=>({socketUrl:"wss://webrtc.yaic.com.cn:18612/api/v1/socket",domain:"admin.com",username:"1001",password:"123456"})}},emits:["update:show"],setup(e,{emit:a}){let n=null,i=null;const u=e,r=a,d=(0,o.iH)(!1),c=(0,o.iH)(!1),v=(0,o.iH)(!1),_=(0,o.iH)(!1),U=(0,o.iH)(!1),D=(0,o.iH)(!1),S=(0,o.iH)(!1),q=(0,o.iH)(!1),H=(0,o.iH)(!1),z=(0,o.iH)(!1),L=(0,o.iH)(""),W=(0,o.iH)(""),Y=(0,o.iH)(!1),x=(0,o.qj)({phoneNumber:""});(0,l.bv)((async()=>{x.phoneNumber=u.initialPhone,await F()})),(0,l.Ah)((()=>{i&&i.stop()})),(0,l.YP)((()=>u.show),(async e=>{d.value=e,e?(await(0,l.Y3)(),!c.value||_.value||U.value||await R()):(i&&(i.stop(),_.value=!1,U.value=!1),B())})),(0,l.YP)(d,(e=>{r("update:show",e)}));const F=async()=>{try{c.value=!1,v.value=!1;const e=await t.e(537).then(t.bind(t,537));if(!e||"function"!==typeof e.SdkClientFactory)throw new Error("SdkClientFactory not found in module");n=new e.SdkClientFactory,c.value=!0}catch(e){console.error("加载SDK失败:",e),v.value=!0,(0,g.CF)("系统初始化失败: "+e.message)}},I=async()=>{await F(),!c.value||_.value||U.value||await R()},R=async()=>{if(n&&!U.value){U.value=!0;try{i=n.getSdkClient({socketUrl:u.sdkConfig.socketUrl,domain:u.sdkConfig.domain,username:u.sdkConfig.username,p:u.sdkConfig.password}),i.setClientListener({onConnected:function(e,a){},onDisconnected:function(e){},onConnectedFailed:function(e){U.value=!1,(0,g.CF)("连接失败: "+e)},onRegistered:function(e,a){e?(U.value=!1,_.value=!0,(0,g.CF)("登录成功"),i.setCallListener({onCallStatus:function(e,a){e&&P(a.state)},onMessage:function(e,a){},onCallChangeConnectState:function(e,a){}})):(U.value=!1,(0,g.CF)("注册失败"))},onUnregistered:function(e,a){_.value=!1},onReconnected:function(e,a){}}),i.start()}catch(e){U.value=!1,console.error("登录失败:",e),(0,g.CF)("登录失败: "+e.message)}}},P=e=>{const a={RINGING:"RINGING",TALKING:"TALKING",RELEASED:"RELEASED",DELIVERED:"DELIVERED"};switch(e){case a.RINGING:q.value=!0,S.value=!1,D.value=!1,L.value="来电...",W.value="ringing",Y.value=!1;break;case a.TALKING:q.value=!1,S.value=!0,D.value=!1,L.value="",W.value="talking",Y.value=!1;break;case a.RELEASED:q.value=!1,S.value=!1,D.value=!1,Y.value||(L.value="通话结束",W.value="released",Y.value=!0,(0,g.CF)("通话已结束")),H.value=!1,z.value=!1;break;case a.DELIVERED:q.value=!1,S.value=!1,D.value=!0,L.value="",W.value="",Y.value=!1;break;default:L.value="",W.value=""}},B=()=>{q.value=!1,S.value=!1,D.value=!1,L.value="",W.value="",H.value=!1,z.value=!1,Y.value=!1},G=async()=>{if(x.phoneNumber){try{if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){const e=await navigator.mediaDevices.getUserMedia({audio:!0});e.getTracks().forEach((e=>e.stop()))}else console.warn("浏览器不支持navigator.mediaDevices.getUserMedia")}catch(e){console.error("获取麦克风权限失败:",e)}i?i.call({calleeNumber:x.phoneNumber}):(0,g.CF)("系统未就绪")}else(0,g.CF)("请输入被叫号码")},j=()=>{i&&i.release()},J=()=>{d.value=!1,r("update:show",!1)};return(e,a)=>{const t=(0,l.up)("van-loading"),o=(0,l.up)("van-button"),n=(0,l.up)("van-field"),i=(0,l.up)("van-popup");return(0,l.wg)(),(0,l.j4)(i,{show:d.value,"onUpdate:show":a[1]||(a[1]=e=>d.value=e),round:"",position:"center",style:{width:"80%",maxHeight:"80%"}},{default:(0,l.w5)((()=>[(0,l._)("div",p,[a[14]||(a[14]=(0,l._)("div",{class:"dialog-header"},[(0,l._)("span",{class:"dialog-title"},"拨打电话")],-1)),(0,l._)("div",m,[c.value||v.value?v.value?((0,l.wg)(),(0,l.iD)("div",f,[a[4]||(a[4]=(0,l._)("span",null,"系统初始化失败",-1)),(0,l.Wm)(o,{size:"small",onClick:I},{default:(0,l.w5)((()=>[...a[3]||(a[3]=[(0,l.Uk)("重试",-1)])])),_:1})])):_.value||v.value||D.value?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("div",y,[(0,l.Wm)(t,{size:"1.25rem"},{default:(0,l.w5)((()=>[...a[5]||(a[5]=[(0,l.Uk)("正在登录...",-1)])])),_:1})])):((0,l.wg)(),(0,l.iD)("div",k,[(0,l.Wm)(t,{size:"1.25rem"},{default:(0,l.w5)((()=>[...a[2]||(a[2]=[(0,l.Uk)("系统初始化中...",-1)])])),_:1})])),c.value&&!v.value?((0,l.wg)(),(0,l.iD)("div",w,[(0,l._)("div",h,[(0,l.Wm)(n,{modelValue:x.phoneNumber,"onUpdate:modelValue":a[0]||(a[0]=e=>x.phoneNumber=e),type:"tel",label:"号码",placeholder:"请输入被叫号码",maxlength:"20",disabled:S.value||D.value},null,8,["modelValue","disabled"])]),L.value?((0,l.wg)(),(0,l.iD)("div",{key:0,class:(0,s.C_)(["call-status",W.value])},(0,s.zw)(L.value),3)):(0,l.kq)("",!0),D.value&&!S.value?((0,l.wg)(),(0,l.iD)("div",b,[(0,l.Wm)(t,{size:"1.25rem",vertical:""},{default:(0,l.w5)((()=>[...a[6]||(a[6]=[(0,l.Uk)(" 正在呼叫 ",-1)])])),_:1})])):(0,l.kq)("",!0),S.value?((0,l.wg)(),(0,l.iD)("div",N,[(0,l.Wm)(t,{size:"1.25rem",vertical:""},{default:(0,l.w5)((()=>[...a[7]||(a[7]=[(0,l.Uk)(" 正在通话 ",-1)])])),_:1})])):(0,l.kq)("",!0),(0,l._)("div",C,[D.value||S.value?((0,l.wg)(),(0,l.iD)("div",A,[(0,l.Wm)(o,{class:"control-btn hangup-btn",round:"",type:"danger",onClick:j},{default:(0,l.w5)((()=>[...a[8]||(a[8]=[(0,l.Uk)(" 挂断 ",-1)])])),_:1})])):q.value&&!S.value?((0,l.wg)(),(0,l.iD)("div",E,[(0,l.Wm)(o,{class:"control-btn hangup-btn",round:"",type:"danger",onClick:j},{default:(0,l.w5)((()=>[...a[9]||(a[9]=[(0,l.Uk)(" 挂断 ",-1)])])),_:1})])):(0,l.kq)("",!0)]),(0,l._)("div",T,[Y.value?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[(0,l.Wm)(o,{class:"cancel-btn",round:"",onClick:J},{default:(0,l.w5)((()=>[...a[10]||(a[10]=[(0,l.Uk)(" 取消 ",-1)])])),_:1}),(0,l.Wm)(o,{class:"confirm-btn",round:"",type:"primary",disabled:!x.phoneNumber,onClick:G},{default:(0,l.w5)((()=>[...a[11]||(a[11]=[(0,l.Uk)(" 拨号 ",-1)])])),_:1},8,["disabled"])],64)):D.value||S.value||q.value?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)(l.HY,{key:1},[(0,l.Wm)(o,{class:"cancel-btn",round:"",onClick:J},{default:(0,l.w5)((()=>[...a[12]||(a[12]=[(0,l.Uk)(" 取消 ",-1)])])),_:1}),(0,l.Wm)(o,{class:"confirm-btn",round:"",type:"primary",disabled:!x.phoneNumber,onClick:G},{default:(0,l.w5)((()=>[...a[13]||(a[13]=[(0,l.Uk)(" 拨号 ",-1)])])),_:1},8,["disabled"])],64))])])):(0,l.kq)("",!0)])])])),_:1},8,["show"])}}},U=t(3744);const D=(0,U.Z)(_,[["__scopeId","data-v-499a6d42"]]);var S=D,q=t(309),H=t(1177),z=t(4891);const L={class:"itemboxs"},W={class:"item-title"},Y={class:"item-content"},x={class:"one-line"},F={style:{color:"#494949"}},I={style:{color:"#494949"}},R={class:"two-line"},P={key:0,style:{margin:"0 0.75rem"}},B={class:"content-button"},G={class:"material-document-container"};var j={__name:"TaskItem",props:{data:{type:Object,default:()=>({})}},setup(e){const a=(0,i.tv)(),t=(0,o.iH)(!1),n=(0,o.iH)(!1),u=(0,o.iH)(!1),c=e,g={socketUrl:"wss://webrtc.yaic.com.cn:18612/api/v1/socket",domain:"admin.com",username:"1001",password:"123456"},p=()=>{const e=event.target.closest(".content-button"),t=event.target.closest(".van-popup")||event.target.closest(".video-sdk-container"),l=event.target.closest(".container");e||t||l||a.push({path:"/caseProgress",query:{taskId:c.data.taskId,surveyStatus:"",registNo:c.data.registNo}})},m=(0,o.iH)(""),k=(e,a)=>{if(a.stopPropagation(),a.preventDefault(),"phone"===e)t.value=!0;else if("photograph"===e)u.value=!0;else if("video"===e){if(window.videoEventProcessing)return;window.videoEventProcessing=!0;const e=new CustomEvent("taskitemVedio",{bubbles:!1,detail:{registNo:c.data.registNo,taskId:c.data.taskId,lossName:c.data.lossName,taskTypeName:c.data.taskTypeName}});window.dispatchEvent(e),setTimeout((()=>{window.videoEventProcessing=!1}),300)}else"edit"===e&&(n.value=!0)},f=e=>{n.value=!1},y=()=>{u.value=!1},w=e=>{console.log("照片上传完成:",e),y()};return(a,i)=>{const c=(0,l.up)("van-tag"),h=(0,l.up)("van-button"),b=(0,l.up)("van-popup");return(0,l.wg)(),(0,l.iD)("div",{class:"item-box",onClick:p},[(0,l.Wm)(q.Z),(0,l._)("div",L,[(0,l._)("div",W,[(0,l._)("div",null,(0,s.zw)(e.data.lossName),1),(0,l.Wm)(c,{color:"#fff","text-color":"#3A8FFF",style:{padding:"2px 0.5rem","margin-left":"0.25rem",background:"rgb(243 247 255)",border:"1px solid rgb(243 247 255)"}},{default:(0,l.w5)((()=>[(0,l.Uk)((0,s.zw)(e.data.taskTypeName),1)])),_:1})]),(0,l._)("div",Y,[(0,l._)("div",x,[(0,l._)("div",null,[i[7]||(i[7]=(0,l.Uk)(" 报案号：",-1)),(0,l._)("span",F,(0,s.zw)(e.data.registNo),1)]),(0,l._)("div",null,[i[8]||(i[8]=(0,l.Uk)(" 报案时间：",-1)),(0,l._)("span",I,(0,s.zw)((0,o.SU)(v())(e.data.insertTimeHis).format("YYYY-MM-DD HH:mm:ss")),1)]),e.data.overDay?((0,l.wg)(),(0,l.j4)(c,{key:0,style:{"margin-left":"8px"},type:"warning"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,s.zw)(e.data.overDay),1)])),_:1})):(0,l.kq)("",!0)]),(0,l._)("div",R,[(0,l._)("div",null,(0,s.zw)(e.data.accidentType),1),e.data.accidentType&&e.data.riskName?((0,l.wg)(),(0,l.iD)("div",P," | ")):(0,l.kq)("",!0),(0,l._)("div",null,(0,s.zw)(e.data.riskName),1)])]),(0,l._)("div",B,[(0,l.Wm)(h,{round:"",size:"small",color:"#f6f6f8",icon:"edit",onClick:i[0]||(i[0]=(0,r.iM)((e=>k("edit",e)),["stop"]))},{default:(0,l.w5)((()=>[...i[9]||(i[9]=[(0,l.Uk)(" 备忘 ",-1)])])),_:1}),(0,l.Wm)(h,{round:"",size:"small",color:"#f6f6f8",icon:"phone-o",onClick:i[1]||(i[1]=(0,r.iM)((e=>k("phone",e)),["stop"]))},{default:(0,l.w5)((()=>[...i[10]||(i[10]=[(0,l.Uk)(" 电话 ",-1)])])),_:1}),(0,l.Wm)(h,{round:"",size:"small",color:"#f6f6f8",icon:"photograph",onClick:i[2]||(i[2]=(0,r.iM)((e=>k("photograph",e)),["stop"]))},{default:(0,l.w5)((()=>[...i[11]||(i[11]=[(0,l.Uk)(" 拍照 ",-1)])])),_:1}),(0,l.Wm)(h,{round:"",size:"small",color:"#f6f6f8",onClick:i[3]||(i[3]=(0,r.iM)((e=>k("video",e)),["stop"])),style:{padding:"0"}},{default:(0,l.w5)((()=>[...i[12]||(i[12]=[(0,l._)("div",{style:{display:"flex","justify-content":"center","align-items":"center",gap:"0.3rem"}},[(0,l._)("img",{src:d,alt:"",style:{width:"30%"}}),(0,l._)("span",null,"视频")],-1)])])),_:1})])]),(0,l.Wm)(S,{show:t.value,"onUpdate:show":i[4]||(i[4]=e=>t.value=e),"initial-phone":m.value,"sdk-config":g},null,8,["show","initial-phone"]),n.value?((0,l.wg)(),(0,l.j4)(H.Z,{key:0,onCloseComponent:i[5]||(i[5]=e=>f()),accidentNo:e.data.registNo},null,8,["accidentNo"])):(0,l.kq)("",!0),(0,l.Wm)(b,{show:u.value,"onUpdate:show":i[6]||(i[6]=e=>u.value=e),position:"bottom",round:"",closeable:"",style:{height:"95%"},onClose:y},{default:(0,l.w5)((()=>[(0,l._)("div",G,[i[13]||(i[13]=(0,l._)("div",{class:"material-header"},[(0,l._)("h3",null,"单证上传")],-1)),u.value?((0,l.wg)(),(0,l.j4)(z.Z,{key:0,"task-id":e.data.taskId,"regist-no":e.data.registNo,onSave:a.handleSave,onSubmit:a.handleSubmit,onUploadComplete:w},null,8,["task-id","regist-no","onSave","onSubmit"])):(0,l.kq)("",!0)])])),_:1},8,["show"])])}}};const J=(0,U.Z)(j,[["__scopeId","data-v-418f0923"]]);var O=J,Z={__name:"TaskList",emits:["getTotal"],setup(e,{expose:a,emit:t}){const s=(0,i.yj)(),n=t,r=((0,o.iH)(!1),(0,o.iH)([])),d=(0,o.iH)(!1),c=(0,o.iH)(!0),v=(0,o.iH)({userCode:"",taskStatu:"",taskType:"",flag:"",taskStartTime:"",taskEndtime:"",registNo:"",licenseNo:"",reportorPhoneNo:""}),g=(0,o.iH)(""),p=(0,o.qj)({loading:!1,finished:!1,pageNum:1,pageSize:10,total:0,taskStartTime:"",taskEndtime:""}),m={0:"现场查勘",1:"本车车损",2:"三者车损",3:"车上物损",4:"三者物损",5:"标的乘客人伤",6:"标的驾驶员人伤",7:"三者人伤"},k=()=>{const e=s.query;Object.assign(v.value,{taskType:e.taskType||"",taskStatu:g.value||(e.taskType?"1":""),flag:"search"===e.flag?"":e.flag,taskStartTime:e.taskStartTime||"",taskEndtime:e.taskEndtime||"",registNo:e.registNo||"",licenseNo:e.licenseNo||"",reportorPhoneNo:e.reportorPhoneNo||""})},f=()=>{p.pageNum=1,p.finished=!1,p.total=0,r.value=[]},y=async(e=!1)=>{if(d.value)console.log("【分页调试】跳过，正在加载中");else try{d.value=!0,e||(p.loading=!0),e?p.pageNum++:(p.pageNum=1,p.finished=!1,r.value=[]),g.value&&"search"!==v.value.flag?v.value.taskStatu=g.value:"search"===v.value.flag&&(v.value.taskStatu="");const a={pageNum:p.pageNum,pageSize:p.pageSize,...v.value};let t;if(console.log("【分页调试】请求参数:",a),"1"===s.query.showtabs){const{data:e}=await(0,u.Ql)(a);t=e}else{const{data:e}=await(0,u.ot)(a);t=e}if(t&&200===t.code){const a=(t.data?.records||[]).map((e=>({...e,taskTypeName:m[e.taskType]||"未知类型"})));e?r.value.push(...a):r.value=a,p.total=t.data?.total||0,n("getTotal",p.total);const l=r.value.length<p.total;p.finished=!l,console.log("【分页调试】分页状态:",{"当前页":p.pageNum,"当前数据条数":r.value.length,"总条数":p.total,"是否还有更多":l,"是否完成":p.finished})}}catch(a){console.error("【分页调试】数据加载失败:",a),p.finished=!0}finally{p.loading=!1,d.value=!1,c.value=!1}},w=()=>{if(console.log("【分页调试】触发onLoad，当前状态:",{loading:p.loading,finished:p.finished,pageNum:p.pageNum,isFirstLoad:c.value}),c.value)return console.log("【分页调试】首次加载，跳过onLoad"),void(p.loading=!1);p.finished||d.value?console.log("【分页调试】跳过加载：finished=",p.finished,"isLoading=",d.value):y(!0)},h=async e=>{console.log("【分页调试】执行reload，类型:",e),c.value=!0,"search"===e?(v.value.flag="",v.value.registNo=s.query.registNo||"",v.value.licenseNo=s.query.licenseNo||"",v.value.reportorPhoneNo=s.query.reportorPhoneNo||"",v.value.taskStartTime=s.query.taskStartTime||"",v.value.taskEndtime=s.query.taskEndtime||"",v.value.taskStatu="",g.value=""):(v.value.flag="",v.value.taskStatu=e,g.value=e,v.value.registNo="",v.value.licenseNo="",v.value.reportorPhoneNo="",v.value.taskStartTime="",v.value.taskEndtime=""),f(),k(),await y(!1)},b=async e=>{console.log("获取数量 - type:",e,"route.query.taskType:",s.query.taskType);try{const a={pageNum:1,pageSize:1,taskStatu:e,taskType:s.query.taskType||""};let t;if(console.log("获取数量 - params:",a),"1"===s.query.showtabs){const{data:e}=await(0,u.Ql)(a);t=e}else{const{data:e}=await(0,u.ot)(a);t=e}if(console.log("获取数量 - response:",t),t&&200===t.code){const a=t.data?.total||0;console.log("获取数量 - total:",a,"状态类型:",e),n("getTotal",a)}}catch(a){console.error("获取数量失败:",a)}};return(0,l.bv)((()=>{})),(0,l.dl)((()=>{JSON.stringify(s.query)!==JSON.stringify(v.value)&&(console.log("【分页调试】路由参数变化，重新初始化"),g.value&&h(g.value))})),a({reload:h,getCount:b}),(e,a)=>{const t=(0,l.up)("van-list");return(0,l.wg)(),(0,l.j4)(t,{loading:p.loading,"onUpdate:loading":a[0]||(a[0]=e=>p.loading=e),finished:p.finished,"finished-text":"没有更多了",onLoad:w,"immediate-check":!1},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(r.value,(e=>((0,l.wg)(),(0,l.j4)(O,{key:e.licenseNo,data:e},null,8,["data"])))),128))])),_:1},8,["loading","finished"])}}};const K=Z;var M=K;const V={class:"view-content"},X={class:"page-header"},Q={key:0},$={class:"tab-title"},ee={key:1,class:"task-list-container"};var ae={__name:"index",setup(e){const a=(0,i.yj)(),t=(0,i.tv)(),u=((0,l.f3)("searchResults"),(0,l.f3)("searchParams"),(0,l.Fl)((()=>"search"===a.query.flag)));(0,l.aZ)({name:"TasksIndex"});const r=(0,l.Fl)((()=>"1"===a.query.showtabs)),d=()=>{t.back()},c=(0,o.iH)("pending"),v=(0,l.Fl)((()=>!u.value&&"1"!==a.query.showtabs)),g=(0,o.qj)({items:[]}),p=(0,l.Fl)((()=>u.value?[{title:"搜索结果",num:0,type:"search"}]:[{title:"待处理",num:0,type:"1"},{title:"处理中",num:0,type:"7"},{title:"已处理",num:0,type:"4"}]));(0,l.YP)(p,(e=>{g.items=[...e]}),{immediate:!0,deep:!0});const m=(0,o.qj)([]),k=async e=>{if(await(0,l.Y3)(),!g.items[e]||!m[e])return void console.error("Tab或组件未就绪:",e);const a=g.items[e];try{"search"===a.type?await(m[e].reload?.("search")):await(m[e].reload?.(a.type))}catch(t){console.error("切换标签失败:",t)}},f=(e,a)=>{console.log("getTotal 接收数据:",{total:e,index:a}),a<0||a>=g.items.length?console.warn("Invalid tab index:",a,"Total tabs:",g.items.length):g.items[a]&&(g.items[a].num=e,console.log("更新tab数量:",g.items[a]))};(0,l.YP)((()=>a.query.flag),(e=>{"search"===e&&m[0]&&(0,l.Y3)((()=>{m[0].reload("search")}))}));const y=async()=>{if(await(0,l.Y3)(),u.value)m[0]&&m[0].reload("search");else if(r.value){const e=a.query.taskStatus||"1",t={1:0,7:1,4:2},s=t[e]||0;c.value=s,await(0,l.Y3)(),await new Promise((e=>setTimeout(e,100))),g.items.forEach(((e,a)=>{m[a]&&(a===s?m[a].reload(e.type):m[a].getCount?.(e.type))}))}else{const e="number"===typeof c.value?c.value:0;await(0,l.Y3)(),await new Promise((e=>setTimeout(e,100))),g.items.forEach(((a,t)=>{m[t]&&(t===e?m[t].reload(a.type):m[t].getCount?.(a.type))}))}};return(0,l.bv)((()=>{y()})),(e,t)=>{const i=(0,l.up)("van-tab"),u=(0,l.up)("van-tabs");return(0,l.wg)(),(0,l.iD)("div",V,[(0,l._)("div",X,[(0,l._)("img",{src:n,alt:"",onClick:t[0]||(t[0]=e=>d()),style:{width:"5%",transform:"scaleX(-1)"}}),t[3]||(t[3]=(0,l._)("div",{class:"page-title"},"案件列表",-1))]),v.value?((0,l.wg)(),(0,l.iD)("div",Q,[(0,l.Wm)(u,{active:c.value,"onUpdate:active":t[1]||(t[1]=e=>c.value=e),class:"flex-auto",type:"card",background:"transparent","title-active-color":"#3A8FFF","title-inactive-color":"#333","lazy-render":!1,onRendered:e.rendered,onChange:k},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(g.items,((e,a)=>((0,l.wg)(),(0,l.j4)(i,{key:e.type,name:a},{title:(0,l.w5)((()=>[(0,l._)("div",$,[(0,l._)("div",null,(0,s.zw)(e.title),1),(0,l._)("div",null,"("+(0,s.zw)(e.num)+")",1)])])),default:(0,l.w5)((()=>[(0,l.Wm)(M,{ref_for:!0,ref:e=>m[a]=e,onGetTotal:e=>f(e,a),taskStatus:e.type},null,8,["onGetTotal","taskStatus"])])),_:2},1032,["name"])))),128))])),_:1},8,["active","onRendered"])])):((0,l.wg)(),(0,l.iD)("div",ee,[(0,l.Wm)(M,{ref:e=>m[0]=e,onGetTotal:t[2]||(t[2]=e=>f(e,0)),taskType:(0,o.SU)(a).query.taskType||(0,o.SU)(a).query.taskStatus||"1"},null,8,["taskType"])]))])}}};const te=(0,U.Z)(ae,[["__scopeId","data-v-3e2f2948"]]);var le=te}}]);